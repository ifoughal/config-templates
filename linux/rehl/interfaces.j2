{%-  if device.interfaces != None %}
{#-    ########################################################################   #}
{#-    deltion of bond interfaces #}
{%-    for interface in device.interfaces.all() %}
{%-        if interface.custom_field_data.get("auto_config", false)  %}
nmcli connection delete {{ interface.name }}
{%-        endif %}
{%-    endfor %}

{#-    ########################################################################   #}
{#-    adding bond interfaces #}
{%-    for interface in device.interfaces.all() %}
{%-      if interface.custom_field_data.get("auto_config", false)  %}
{%-        if interface.type == "lag"  %}
{%-          set inter_type = "bond" %}
nmcli connection add type {{ inter_type }} con-name {{ interface.name }} ifname {{ interface.name }}
nmcli connection modify {{ interface.name }} mode 802.3ad
nmcli connection modify {{ interface.name }} miimon 100
nmcli connection modify {{ interface.name }} lacp_rate {{ "fast" if interface.custom_field_data.get("lacp_mode") == "short" else interface.custom_field_data.get("lacp_mode") }}

{%-          if interface.mtu != None  %}
nmcli connection modify {{ interface.name }} 802-3-ethernet.mtu {{ interface.mtu }}
{%-          endif  %}
{%-        endif  %}
{%-      endif %}
{%-    endfor %}
{#-    ######################################################################## #}



{#-    ######################################################################## #}
{#-      Ether interfaces #}
{#-    ######################################################################## #}


{#-    ######################################################################## #}
{#-    adding vlan interfaces #}
{#-    ######################################################################## #}

{%-  endif %}
echo "Config done"