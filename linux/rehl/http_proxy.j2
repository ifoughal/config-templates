{%- if device.custom_field_data.get('http_proxy') != None or device.custom_field_data.get('https_proxy') != None %}
{%- 	if device.custom_field_data.get('http_proxy') != None %}
{%-			set http_proxy=device.custom_field_data.get('http_proxy')  %}
{%-			if ipam['Service'].objects.get(id=http_proxy).ipaddresses != None %}
{%-				set ip_address = ipam['Service'].objects.get(id=http_proxy).ipaddresses.first().address.ip %}
{%-				set port = ipam['Service'].objects.get(id=http_proxy).ports[0] %}
export http_proxy={{ ip_address }}:{{ port }}
export HTTP_PROXY={{ ip_address }}:{{ port }} 
{%-			endif %}
{% 		endif %}
{%- 	if device.custom_field_data.get('https_proxy') != None %}
{%-			set https_proxy=device.custom_field_data.get('https_proxy')  %}
{%-			if ipam['Service'].objects.get(id=https_proxy).ipaddresses != None %}
######################################################################################
{%-				set ip_address = ipam['Service'].objects.get(id=https_proxy).ipaddresses.first().address.ip %}
{%-				set port = ipam['Service'].objects.get(id=https_proxy).ports[0] %}
export https_proxy={{ ip_address }}:{{ port }}
export HTTPS_PROXY={{ ip_address }}:{{ port }} 
{%-			endif %}
{% 		endif %}
######################################################################################
{% endif %}
